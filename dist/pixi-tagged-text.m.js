import{Texture as t,BaseTexture as e}from"@pixi/core";import{Sprite as n}from"@pixi/sprite";import{TextMetrics as r,Text as i}from"@pixi/text";import{Container as o}from"@pixi/display";import{Graphics as a}from"@pixi/graphics";import"@pixi/events";import s from"emoji-regex";import{Rectangle as u}from"@pixi/math";function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,"symbol"==typeof(i=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key))?i:String(i),r)}var i}function c(){return c=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},c.apply(this,arguments)}function d(t,e){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},d(t,e)}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function h(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var p,g,v,y,w=function(t,e){return c({},t,e)},m=function(t){return t[t.length-1]},x=function(t){return void 0!==t},b=function(t,e){return function(n){return[n].flat(255).reduce(t,e)}},S=function(t){return b(function(e,n){return e&&t(n)},!0)},_="imgSrc",T="imgDisplay",k=function(){return{content:"",bounds:new u,fontProperties:{ascent:0,descent:0,fontSize:0},style:{},tags:"",textDecorations:[]}},C=function(t){return""!==t&&t.split("").every(function(t){return 0===t.search(/\s/)})},N=S(function(t){return t.content instanceof n}),F=function(t){return"string"==typeof t.content},j=S(F),E=S(function(t){return void 0!==t&&F(t)&&C(t.content)}),O=function(t){return void 0!==t&&F(t)&&C(e=t.content)&&"\n"===e;var e},D=function(t){return void 0!==t&&S(O)(t)},M=(p=E,function(t){return!p(t)}),P=function(t){return t instanceof Object&&0===Object.keys(t).length},I=function(t){void 0===t&&(t=["\\w+"]);var e=t.join("|"),n=function(t){return"("+t+")"},r=function(t){return"(?:"+t+")"},i=r("\"|'"),o="[^"+i+"]",a=n(e),s=o+"+",u=n(r("\\s+"+r("[A-Za-z0-9_\\-]+")+"="+i+r(s)+i)+"*")+"+";return new RegExp("<"+a+u+"\\s*>|</"+a+"\\s*>","g")},U="__EMOJI__",z=function(t){var e,n=t[1],r=t.index;return{tag:t[0],tagName:null!=n?n:t[3],isOpening:void 0!==n,attributes:(e=t[2],void 0===e&&(e=""),""===e?{}:e.trim().split(/\s+/).reduce(function(t,e){var n=e.split("="),r=n[0].trim(),i=n[1].substr(1,n[1].length-2).trim();return t[r]=i,t},{})),index:r}},W=(g=function(t){return"("+t+")"},v=function(t){return t+"*"},new RegExp("<"+g("[A-Za-z_]"+v("[A-Za-z0-9_]"))+g(v(function(){return"[^"+[].slice.call(arguments).join("")+"]"}("/",">")))+"/>","gs")),A=function(t){return c({tag:t.tagName,children:[]},P(t.attributes)?{}:{attributes:t.attributes})},L=function(t){for(var e=t.split(" "),n="",r=0;r<e.length;r++)n+=""+e[r].charAt(0).toUpperCase()+e[r].substr(1)+" ";return n.trim()},H=function(t){return r.measureFont(t.font)},R=function(t,e){if(void 0===e&&(e=!1),e)return t.updateText(!1),H(t.context);var n,r=H(t.context),i=null!=(n=t.style.fontSize)?n:NaN;if(10===r.ascent&&2===r.descent&&(isNaN(Number(i))||i>12))throw new Error("getFontPropertiesOfText() returned metrics associated with a Text field that has not been updated yet. Please try using the forceUpdate parameter when you call this function.");return H(t.context)},G=((y={align:"left",valign:"baseline"})[T]="inline",y.wordWrap=!0,y.wordWrapWidth=500,y.lineSpacing=0,y.fill=0,y),V=w,B=function(t){return t.filter(x).reduce(V,{})},Z=function(t,e,n){var r;void 0===n&&(n={});var i=null!=(r=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e={}),!P(e)||!P(t))return w(e,function(t){var e={};for(var n in t){var r=t[n];e[n]=!1===isNaN(parseFloat(r))?parseFloat(r):r}return e}(t))}(n,e[t]))?r:{};if(0!==Object.values(i).length)return i},J=function(t,e){return void 0===e&&(e={x:0,y:0}),new u(e.x+t.x,e.y+t.y,t.width,t.height)},Y=function(t){return function(e){return e.map(function(t){return function(e){return c({},e,{x:e.x+t.x,y:e.y+t.y})}}(t))}},$=function(t){var e=t[0],n=m(t);return void 0===e?0:n===e?e.width:n.x+n.width-e.x},X=function(t){return function(e){var n;return c({},e,((n={}).x=t,n))}},q=function(t){return function(e){var n;return e.map(function(e){return void 0===n?(e.bounds.x=t,n=e.bounds):(e.bounds.x=n.x+n.width,n=e.bounds),e})}},K=function(t,e){if(void 0===t&&(t={x:NaN,y:NaN,width:NaN,height:NaN}),void 0===e&&(e={x:NaN,y:NaN,width:NaN,height:NaN}),isNaN(t.x))return e;var n=Math.min(t.x,e.x),r=Math.min(t.y,e.y);return{x:n,y:r,width:Math.max(t.x+t.width,e.x+e.width)-n,height:Math.max(t.y+t.height,e.y+e.height)-r}},Q=b(function(t,e){return K(t,e.bounds)},{x:NaN,y:NaN,width:NaN,height:NaN}),tt=function(t){return t.reduce(function(t,e,n){return 0===n?[X(0)(e)]:t.concat([X(t[n-1].x+t[n-1].width)(e)])},[])},et=function(t){return b(function(t,e){var n,r,i=null!=(n=e.bounds.height)?n:0;return N(e)&&(i+=e.fontProperties.descent),i>(null!=(r=null==t?void 0:t.bounds.height)?r:0)?e:t},k())(t)},nt=function(t){return""!==t},rt="_ðŸ”ª_",it=function(t){return t.replace(/\s/g,rt+"$&"+rt).split(rt).filter(function(t){return""!==t})},ot={debug:!1,debugConsole:!1,splitStyle:"words",imgMap:{},skipUpdates:!1,skipDraw:!1,drawWhitespace:!1,wrapEmoji:!0},at=16776960,st={fontFamily:"courier",fontSize:10,fill:16777215,dropShadow:!0},ut={default:G};Object.freeze(ut),Object.freeze(G);var lt=/*#__PURE__*/function(r){var u,f;f=r,(u=w).prototype=Object.create(f.prototype),u.prototype.constructor=u,d(u,f);var p,g,v,y=w.prototype;function w(t,e,n,i){var a;void 0===t&&(t=""),void 0===e&&(e={}),void 0===n&&(n={}),(a=r.call(this,i)||this)._options=void 0,a._needsUpdate=!0,a._needsDraw=!0,a._tokens=[],a._text="",a._tagStyles={},a._textFields=[],a._sprites=[],a._decorations=[],a._spriteTemplates={},a._debugGraphics=null,a._textContainer=void 0,a._decorationContainer=void 0,a._spriteContainer=void 0,a._debugContainer=void 0,a._textContainer=new o,a._spriteContainer=new o,a._decorationContainer=new o,a._debugContainer=new o,a.addChild(a._textContainer),a.addChild(a._spriteContainer),a.addChild(a._decorationContainer),a.addChild(a._debugContainer),a.resetChildren();var s=c({},ot,n);a._options=s,e=c({default:{}},e),a.options.wrapEmoji&&(e[U]={fontFamily:"sans-serif"});var u=c({},G,e.default);return e.default=u,a.tagStyles=e,a.options.imgMap&&a.createSpriteTemplatesFromSourceMap(a.options.imgMap),a.text=t,a}return y.setText=function(t,e){t===this._text&&!1===this._needsUpdate||(this._text=t,this._needsUpdate=!0,this.updateIfShould(e))},y.setTagStyles=function(t,e){var n=this;Object.entries(t).forEach(function(t){return n.setStyleForTag(t[0],t[1],!0)}),this._needsUpdate=!0,this.updateIfShould(e)},y.getStyleForTag=function(t,e){return void 0===e&&(e={}),Z(t,this.tagStyles,e)},y.getStyleForTags=function(t){var e=this,n=t.map(function(t){return e.getStyleForTag(t.tagName,t.attributes)});return B(n)},y.setStyleForTag=function(t,e,n){return this.tagStyles[t]=e,"default"===t&&this.defaultStyle[_]&&(console.error('Style "'+_+'" can not be set on the "default" style because it will add images to EVERY tag!'),this.defaultStyle[_]=void 0),this._needsUpdate=!0,this.updateIfShould(n),!0},y.removeStylesForTag=function(t,e){return t in this.tagStyles&&(delete this.tagStyles[t],this._needsUpdate=!0,this.updateIfShould(e),!0)},y.setDefaultStyle=function(t,e){this.setStyleForTag("default",t,e)},y.resetChildren=function(){this._debugContainer.removeChildren(),this._textContainer.removeChildren(),this._spriteContainer.removeChildren(),this._decorationContainer.removeChildren(),this._textFields=[],this._sprites=[],this._decorations=[]},y.createSpriteTemplatesFromSourceMap=function(r){var i=this;this._spriteTemplates={},Object.entries(r).forEach(function(r){var o,a,s,u,l=r[0],d=r[1];if(d instanceof n)s=d;else if("string"==typeof(u=d)||u instanceof t||u instanceof HTMLCanvasElement||u instanceof HTMLVideoElement)s=n.from(d);else{if(!function(t){return t instanceof HTMLImageElement||t instanceof e}(d))throw new TypeError("The spriteSource provided for key "+l+" was not in a valid format. Please use a Sprite, Texture, BaseTexture, string, HTMLImageElement, HTMLVideoElement, HTMLCanvasElement, or SVGElement");s=n.from(t.from(d))}var f=s.texture;void 0!==f&&f.baseTexture.addListener("update",function(t){return i.onImageTextureUpdate(t)}),i.spriteTemplates[l]=s;var h=null!=(o=i.getStyleForTag(l))?o:{},p=c(((a={})[_]=l,a),h);i.setStyleForTag(l,p)})},y.onImageTextureUpdate=function(t){this._needsUpdate=!0,this._needsDraw=!0,this.updateIfShould()},y.updateIfShould=function(t){return(!1===t||void 0===t&&!1===this.options.skipUpdates)&&(this.update(),!0)},y.update=function(t){var e=this.tagStyles,r=this.options.splitStyle,o=this.options.imgMap&&this.spriteTemplates,a=function(t,e,r){var i,o=null!=(i=e.default)?i:{},a=[],s={};return function t(i){var u;if("string"==typeof i)return i;var l,d=i.tag,f=i.attributes,h=o,p="";d&&(a.push({tagName:d,attributes:void 0===f?{}:f}),p=(l=a,l.map(function(t){return t.tagName})).join(","),h=function(t,e,n){var r=JSON.stringify(t);if(void 0===n[r]){var i=e.default,o=t.map(function(t){return function(t,e){return Z(t.tagName,e,t.attributes)}(t,e)}),a=[i].concat(o);n[r]=B(a)}return n[r]}(a,e,s),h=function(t){var e=t.textDecoration;if(void 0===e||"normal"===e)return t;var n=t.decorationColor||t.fill||G.fill,r=t.decorationThickness||1;function i(e,i){var o,a,s,u,l;return void 0===i&&(i=e),null!=(o=t.textDecoration)&&o.includes(e)?((l={})[i+"Color"]=null!=(a=t[i+"Color"])?a:n,l[i+"Thickness"]=null!=(s=t[i+"Thickness"])?s:r,l[i+"Offset"]=null!=(u=t[i+"Offset"])?u:0,l):{}}return c({},t,i("underline"),i("overline"),i("line-through","lineThrough"))}(h));var g={style:h,tags:p,children:i.children.map(t)},v=null!=(u=h[_])?u:"";if(v){if(void 0===r)throw new Error("An image tag with "+_+'="'+v+'" was encountered, but no imgMap was provided. Please include a valid Sprite in the imgMap property in the options in your TaggedText constructor.');var y=r[v];if(void 0===y)throw new Error("An image tag with "+_+'="'+v+'" was encountered, but there was no matching sprite in the sprite map. Please include a valid Sprite in the imgMap property in the options in your TaggedText constructor.');if(y instanceof n==0)throw new Error('The image reference you provided for "'+v+'" is not a Sprite. The imgMap can only accept PIXI.Sprite instances.');var w=function(t){return new n(t.texture)}(y);g.children=[w].concat(g.children)}return a.pop(),g}(t)}(function(t,e,n){n&&function(t){return s().test(t)}(t)&&(t=function(t){var e=new RegExp("((<|</)[^>]*)?("+s().source+")+","gums");return t.replaceAll(e,function(t,e){return(null==e?void 0:e.length)>0?t:"<"+U+">"+t+"</"+U+">"})}(t)),t=function(t){return t.replace(W,function(t,e,n){void 0===n&&(n="");var r="<"+e+n+"></"+e+">";return(r=r.replace(/\s+/g," ")).replace(/\s>/g,">")})}(t);for(var r,i=I(e),o=[];r=i.exec(t);){var a=z(r);o.push(a)}return{children:function(t,e){var n={children:[]};""!==t[0]&&n.children.push(t[0]);for(var r=[n],i=0;i<e.length;i++){var o,a=e[i],s=null!=(o=t[i+1])?o:"";if(a.isOpening){var u=A(a);""!==s&&u.children.push(s),m(r).children.push(u),r.push(u)}else{var l=r.pop();if(void 0===l||l.tag!==a.tagName)throw new Error('Unexpected tag nesting. Found a closing tag "'+a.tagName+'" that doesn\'t match the previously open tag "'+(null==l?void 0:l.tag)+'"');""!==s&&m(r).children.push(s)}}return r.length>1&&console.warn("Found "+(r.length-1)+" unclosed tags in\n"+r.map(function(t){return t.tag}).join("-")),n.children}(function(t,e){for(var n,r,i=[],o=t,a=0,s=h(e);!(r=s()).done;)if(n=r.value,void 0!==o){var u=n.index-a,l=u+n.tag.length;a+=l;var c=o.substr(0,u);i.push(c),o=o.substr(l)}return i.push(o),i}(t,o),o)}}(this.text,Object.keys(this.tagStyles),this.options.wrapEmoji),e,o),u=function(t,e){var r,o;void 0===e&&(e="words");var a,s=new i(""),u=t.style,l=t.children.flatMap(function t(r,i){return function(o){var u=[];if(s.style=c({},r,{wordWrap:!1,dropShadowBlur:0,dropShadowDistance:0,dropShadowAngle:0,dropShadow:!1}),"string"==typeof o){var l=function(t,e){if("words"===e)return[t].flatMap(it).filter(nt);if("characters"===e)return t.split("");var n=' Supported styles are "words" and "characters"',r=e.toLowerCase();throw 0===r.indexOf("char")?n='Did you mean "characters"?':0===r.indexOf("wor")&&(n='Did you mean "words"?'),new Error('Unsupported split style "'+e+'". '+n)}(o,e),d=l.map(function(t){var e,n,o;switch(r.textTransform){case"uppercase":s.text=t.toUpperCase();break;case"lowercase":s.text=t.toLowerCase();break;case"capitalize":s.text=L(t);break;default:s.text=t}var u=null!=(e=r.fontScaleWidth)?e:1,l=null!=(n=r.fontScaleHeight)?n:1,d=isNaN(u)||u<0?0:u,f=isNaN(l)||l<0?0:l;s.scale.set(d,f),(a=c({},R(s,!0))).ascent*=f,a.descent*=f,a.fontSize*=f;var h=J(s),p=null!=(o=s.style.strokeThickness)?o:0;p>0&&(a.descent+=p/2,a.ascent+=p/2,a.fontSize=a.ascent+a.descent);var g=function(t,e,n){var r=n.descent,i=n.ascent,o=r,a=i-o,s=e.width;return["underline","overline","lineThrough"].map(function(e){var n,u=t[e+"Color"],l=t[e+"Thickness"],c=null!=(n=t[e+"Offset"])?n:0;if(void 0!==u&&void 0!==l){var d=c;return"underline"===e?d+=i+r/2:"lineThrough"===e&&(d+=o+a/2),{color:u,bounds:{x:0,y:d,width:s,height:l}}}}).filter(function(t){return void 0!==t})}(r,h,a);return{content:t,style:r,tags:i,bounds:h,fontProperties:a,textDecorations:g}});u=u.concat(d)}else if(o instanceof n){var f=o,h="icon"===r[T];if(a=c({},R(s,!0)),h){var p=Math.max(f.height,1);p>1&&1===f.scale.y&&f.scale.set(a.ascent/p*.8)}var g=J(f);u.push({content:f,style:r,tags:i,bounds:g,fontProperties:a,textDecorations:void 0})}else{var v=o.children,y=o.style,w=o.tags;if(void 0===y)throw new Error("Expected to find a 'style' property on "+o);u=u.concat(v.flatMap(t(y,w)))}return u}}(u,"")),d=u.wordWrap,f=u.wordWrapWidth,p=void 0!==f&&!isNaN(f)&&f>0,g=null!=(r=u.lineSpacing)?r:0,v=null!=(o=u.align)?o:"left";return function(t,e,n,r){var i,o={x:0,y:0},a=0,s=[],u=[],l=[],d=0;function f(){void 0!==s&&s.length>0&&u.push(s),s=[],a=0}function p(){l.push(u),u=[]}function g(t){p(),o.x=0,o.y=o.y+d,d=0,v(t)}function v(t){var e,r,i,o,a=null!=(e=null==t||null==(r=t.fontProperties)?void 0:r.fontSize)?e:0,s=null!=(i=null==t||null==(o=t.bounds)?void 0:o.height)?i:0;d=Math.max(d,a,n),!1===D(t)&&(d=Math.max(d,s))}function y(t){v(t),t.bounds.x=o.x,t.bounds.y=o.y,o.x+=t.bounds.width}function w(){s.forEach(y)}function m(t){return"block"===t.style[T]}function x(t){s.push(t),a+=t.bounds.width}for(var b=0;b<t.length;b++){var S=E(i=t[b]),_=D(i),C=N(i);(S||C)&&(w(),f()),x(i),v(i),S&&(w(),f()),(_||m(i)||o.x+a>e&&u.length>0)&&g(i)}s.length>0&&(w(),f()),u.length>0&&p();var F=function(t){for(var e,n=h(t);!(e=n()).done;)for(var r=e.value,i=r.length;i>=0;){var o=r[i-=1];if(M(o))break;for(var a,s=h(o);!(a=s()).done;){var u=a.value;u.bounds.width=0,u.bounds.height=Math.min(u.bounds.height,u.fontProperties.fontSize)}}return t}(l),j=function(t,e,n){for(var r,i=k(),o=0,a=[],s=h(t);!(r=s()).done;){var u,l,d,f,p=r.value,g=[],v=et(p),y=null!=(u=null==(l=v.bounds)?void 0:l.height)?u:0,w=null!=(d=null==(f=v.fontProperties)?void 0:f.ascent)?d:0;N(v)&&(y+=v.fontProperties.descent,w=v.bounds.height),0===y?v=i:i=v;for(var m,x=h(p);!(m=x()).done;){for(var b,S=[],_=h(m.value);!(b=_()).done;){var T=b.value;if(D(T)){var C=c({},T);S.push(C)}else{var F=T.bounds,j=T.fontProperties,E=T.style,O=F.height,M=c({},F),P=E.valign,I=j.ascent;N(T)&&(I=T.bounds.height);var U=0;switch(P){case"bottom":U=o+y-O;break;case"middle":U=o+(y-O)/2;break;case"top":U=o;break;default:U=o+w-I}M.y=U;var z=c({},T,{bounds:M});S.push(z)}}g.push(S)}o+=y+e,a.push(g)}return a}(function(t,e,n){var r,i;switch(t){case"left":r=tt;break;case"right":r=function(t){return function(e){return Y({x:t-$(e),y:0})(tt(e))}}(e);break;case"center":r=function(t){return function(e){return Y({x:(n=$(e),r=t,(r-n)/2),y:0})(tt(e));var n,r}}(e);break;case"justify":i=e,r=function(t){if(0===t.length)return[];var e=t.filter(function(t){return t.width>0}),n=e.length;if(1===n){var r=t[0],o=t.slice(1);return r.x=0,[r].concat(o)}for(var a,s=[],u=function(t){return t.reduce(K)}(e),l=(i-u.width)/(n-1),d=0;d<t.length;d++){var f=t[d];if(0!==f.width){var h;if(h=void 0===a?0:a.x+a.width+l,isNaN(h))throw new Error("Something went wrong with the justified layout calculation. x is NaN.");var p=X(h)(f);a=p,s[d]=p}else s[d]=c({},f)}return s};break;default:throw new Error("Unsupported alignment type "+t+'! Use one of : "left", "right", "center", "justify"')}for(var o,a=h(n);!(o=a()).done;){for(var s,u=o.value,l=[],d=h(u);!(s=d()).done;){var f=Q(s.value);if(l.push(f),isNaN(f.x))throw new Error("wordBounds not correct")}for(var p=r(l),g=0;g<u.length;g++){var v=u[g];u[g]=q(p[g].x)(v)}}return n}(r,e,F),n);return j}(l,d&&p?f:Number.POSITIVE_INFINITY,g,v)}(a,r);return this._tokens=u,this._needsDraw=!0,this.drawIfShould(t),this.options.debugConsole&&console.log(this.toDebugString()),this._needsUpdate=!1,u},y.drawIfShould=function(t){return(!1===t||void 0===t&&!1===this.options.skipDraw)&&(this.draw(),!0)},y.draw=function(){var t=this;this.resetChildren();var e,n=this.options.drawWhitespace,r=n?this.tokensFlat:this.tokensFlat.filter(M),i=!1;r.forEach(function(n){if(j(n)&&(e=t.createTextFieldForToken(n),t.textContainer.addChild(e),t.textFields.push(e),n.textDecorations&&n.textDecorations.length>0)){for(var r,o=h(n.textDecorations);!(r=o()).done;){var a=t.createDrawingForTextDecoration(r.value);e.addChild(a),t._decorations.push(a)}i=!0}N(n)&&(t.sprites.push(e=n.content),t.spriteContainer.addChild(e));var s=n.bounds;e.x=s.x,e.y=s.y}),!1===n&&i&&console.warn("Warning: you may want to set the `drawWhitespace` option to `true` when using textDecoration (e.g. underlines) otherwise, spaces will not have text decorations."),this.options.debug&&this.drawDebug(),this._needsDraw=!1},y.createDrawingForTextDecoration=function(t){var e=t.bounds,n=t.color,r=new a;if("string"==typeof n){if(0!==n.indexOf("#"))throw new Error("Sorry, at this point, only hex colors are supported for textDecorations like underlines. Please use either a hex number like 0x66FF33 or a string like '#66FF33'");n="0x"+n.substring(1),n=parseInt(n,16)}return r.beginFill(n).drawRect(e.x,e.y,e.width,e.height).endFill(),r},y.createTextFieldForToken=function(t){var e=t.style.textTransform,n=t.content;switch((void 0===e?"":e).toLowerCase()){case"lowercase":n=n.toLowerCase();break;case"uppercase":n=n.toUpperCase();break;case"capitalize":n=L(n)}var r=new i(n,t.style),o=t.style,a=o.fontScaleWidth,s=void 0===a?1:a,u=o.fontScaleHeight,l=void 0===u?1:u,c=s=isNaN(s)||s<0?0:s,d=l=isNaN(l)||l<0?0:l,f=Math.max(s,l);if(f>1){var h;f===l?(c/=f,d=1):(d/=f,c=1);var p=null!=(h=r.style.fontSize)?h:0,g=("string"==typeof p?function(t){var e=t.split(/(%|pt|px|r?em)/),n=e[1],r=parseFloat(e[0]);switch(n){case"%":return.16*r;case"em":case"rem":return 16*r;case"pt":return 1.3281472327365*r;default:return r}}(p):p)*f;r.style.fontSize=g}return r.scale.set(c,d),r},y.toDebugString=function(){var t=this.tokens,e=this.untaggedText+"\n=====\n",n="\n    ";return void 0!==t&&(e+=t.map(function(t,e){return t.map(function(t,r){return t.map(function(t,i){var o="";j(t)?o=D(t)?"\\n":'"'+t.content+'"':N(t)&&(o="[Image]");var a="\n"+o+": ("+e+"/"+r+"/"+i+")";return a+=n+"tags: "+(0===t.tags.length?"<none>":t.tags.split(",").map(function(t){return"<"+t+">"}).join(", ")),a+=n+"style: "+Object.entries(t.style).map(function(t){return t.join(":")}).join("; "),(a+=n+"size: x:"+t.bounds.x+" y:"+t.bounds.y+" width:"+t.bounds.width+" height:"+t.bounds.height+" bottom:"+(t.bounds.height+t.bounds.y)+" right:"+(t.bounds.x+t.bounds.width))+n+"font: fontSize:"+t.fontProperties.fontSize+" ascent:"+t.fontProperties.ascent+" descent:"+t.fontProperties.descent}).join("\n")})})),e},y.drawDebug=function(){var t=this.tokens;this._debugGraphics=new a,this.debugContainer.addChild(this._debugGraphics);var e=this._debugGraphics;function n(t,e){var n=new i(t,st);return n.x=e.x+1,n.y=e.y+1,n}e.clear();for(var r=0;r<t.length;r++){var o=t[r],s=Q(o);if(this.defaultStyle.wordWrap){var u,l=null!=(u=this.defaultStyle.wordWrapWidth)?u:this.width;e.endFill().lineStyle(.5,at,.2).drawRect(0,s.y,l,s.height).endFill()}for(var c=0;c<o.length;c++)for(var d,f=h(o[c]);!(d=f()).done;){var p=d.value,g=N(p),v=p.bounds,y=v.x,w=v.y,m=v.width,x=w+(g?p.bounds.height:p.fontProperties.ascent),b=p.bounds.height;g&&(b+=p.fontProperties.descent),E(p)&&!1===this.options.drawWhitespace?e.lineStyle(1,11184810,1).beginFill(13421772,.2):e.lineStyle(1,16764108,1).beginFill(15658734,.2),D(p)?this.debugContainer.addChild(n("â†©ï¸Ž",{x:y,y:w+10})):e.lineStyle(.5,at,.2).drawRect(y,w,m,b).endFill().lineStyle(1,16777113,1).beginFill().drawRect(y,x,m,1).endFill(),j(p)&&this.debugContainer.addChild(n(""+p.tags,{x:y,y:w}))}}},p=w,v=[{key:"defaultStyles",get:function(){return ut}},{key:"defaultOptions",get:function(){return ot}}],(g=[{key:"options",get:function(){return this._options}},{key:"needsUpdate",get:function(){return this._needsUpdate}},{key:"needsDraw",get:function(){return this._needsDraw}},{key:"tokensFlat",get:function(){return this._tokens.flat(3)}},{key:"tokens",get:function(){return this._tokens}},{key:"text",get:function(){return this._text},set:function(t){this.setText(t)}},{key:"untaggedText",get:function(){return this.text.replace(I(),"")}},{key:"tagStyles",get:function(){return this._tagStyles},set:function(t){this.setTagStyles(t)}},{key:"defaultStyle",get:function(){var t;return null==(t=this.tagStyles)?void 0:t.default},set:function(t){this.setDefaultStyle(t)}},{key:"textFields",get:function(){return this._textFields}},{key:"sprites",get:function(){return this._sprites}},{key:"decorations",get:function(){return this._decorations}},{key:"spriteTemplates",get:function(){return this._spriteTemplates}},{key:"textContainer",get:function(){return this._textContainer}},{key:"decorationContainer",get:function(){return this._decorationContainer}},{key:"spriteContainer",get:function(){return this._spriteContainer}},{key:"debugContainer",get:function(){return this._debugContainer}}])&&l(p.prototype,g),v&&l(p,v),Object.defineProperty(p,"prototype",{writable:!1}),w}(n);export{lt as default};
//# sourceMappingURL=pixi-tagged-text.m.js.map
